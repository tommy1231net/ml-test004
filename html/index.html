<!DOCTYPE html>
<html>
<head>
    <title>ML Prediction: Penguin Weight</title>
    <meta charset="utf-8">
    <style>
        body { font-family: sans-serif; margin: 2em; }
        .container { max-width: 500px; }
        label { display: block; margin-top: 10px; }
        input, select { width: 100%; padding: 5px; }
        button { margin-top: 20px; padding: 10px; width: 100%; cursor: pointer; }
        #result { margin-top: 20px; font-weight: bold; color: #2c3e50; }
    </style>
</head>
<body>
    <div class="container">
        <h2 style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #0000ff">
            Infrastructure:
        </h2>
        <h2 style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #0000ff">
            Provisioned via Terraform Managed Code
        </h2>
        <h2 style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; color: #34495e;">
            ML Prediction: <span style="font-size: 0.8em; color: #7f8c8d;">How heavy is that penguin?üêß</span>
        </h2>
        <table>
            <tr>
                <td>
                    <div class="image-area">
                      <img id="target-image" src="Adelie.png" alt="Selected Penguin Image" style="width: 40%;">
                    </div>
                </td>
            </tr>
            <tr>
                <td>
                    Penguin Species: „Éö„É≥„ÇÆ„É≥Á®Æ
                </td>
            </tr>
            <tr>
                <td>
                    <select id="species" onchange="changeImage()">
                        <option value="Adelie">Adelie: „Ç¢„Éá„É™„Éº</option>
                        <option value="Chinstrap">Chinstrap: „Éí„Ç≤</option>
                        <option value="Gentoo">Gentoo: „Ç∏„Çß„É≥„ÉÑ„Éº</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Islands they live on: ÁîüÊÅØ„Åô„ÇãÂ≥∂
                </td>
            </tr>
            <tr>
                <td>
                    <select id="island">
                        <option value="Torgersen">Torgersen</option>
                        <option value="Biscoe">Biscoe</option>
                        <option value="Dream">Dream</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    Bill length(mm): „Åè„Å°„Å∞„Åó„ÅÆÈï∑„Åï
                </td>
            </tr>
            <tr>
                <td>
                    <input type="number" id="bill_l" value="50">
                </td>
            </tr>
            <tr>
                <td>
                    Bill Depth(mm): „Åè„Å°„Å∞„Åó„ÅÆÊ∑±„Åï
                </td>
            </tr>
            <tr>
                <td>
                    <input type="number" id="bill_d" value="20">
                </td>
            </tr>
            <tr>
                <td>
                    Flipper Lenght(mm): ÁæΩ„ÅÆÈï∑„Åï
                </td>
            </tr>
            <tr>
                <td>
                    <input type="number" id="flipper" value="200">
                </td>
            </tr>
            <tr>
                <td>
                    Sex: ÊÄßÂà•
                </td>
            </tr>
            <tr>
                <td>
                    <select id="sex">
                        <option value="MALE">Male: „Ç™„Çπ</option>
                        <option value="FEMALE">Female: „É°„Çπ</option>
                    </select>
                </td>
            </tr>
            <tr>
                <td>
                    <button onclick="predict()">Display Weight Prediction Below: ‰ΩìÈáç‰∫àÊ∏¨„Çí‰∏ã„Å´Ë°®Á§∫</button>
                </td>
            </tr>
            <tr>
                <td>
                    <div id="result"></div>
                </td>
            </tr>
        </table>
    </div>

    <script>
        function changeImage() {
          const selector = document.getElementById('species');
          const image = document.getElementById('target-image');
  
          // ÈÅ∏Êäû„Åï„Çå„Åüvalue„ÅÆÂÄ§„Çíimg„Çø„Ç∞„ÅÆsrc„Å´‰ª£ÂÖ•
          image.src = selector.value + ".png";
        }
        
        async function predict() {
            const resultDiv = document.getElementById('result');
            // Replace with the Cloud Run URL with "/predict" appended.
            const url = "https://ml-test004-api-772435570066.asia-northeast1.run.app/predict";
        
            resultDiv.innerText = "‚è≥ ‰∫àÊ∏¨Ë®àÁÆó‰∏≠...";
            resultDiv.style.color = "#2c3e50";
        
            const data = {
                species: document.getElementById('species').value,
                island: document.getElementById('island').value,
                bill_length_mm: parseFloat(document.getElementById('bill_l').value),
                bill_depth_mm: parseFloat(document.getElementById('bill_d').value),
                flipper_length_mm: parseFloat(document.getElementById('flipper').value),
                sex: document.getElementById('sex').value
            };

            try {
                const res = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });

                if (!res.ok) {
                    throw new Error(`API„Ç®„É©„Éº: ${res.status} ${res.statusText}`);
                }
        
                const result = await res.json();
        
                resultDiv.innerText = "‚úÖ ‰∫àÊ∏¨‰ΩìÈáç: " + Math.round(result.predicted_body_mass_g) + " g";

            } catch (error) {
                console.error("Error details:", error);
                resultDiv.innerText = "„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: " + error.message;
                resultDiv.style.color = "red";
            }
        }
    </script>
</body>
</html>